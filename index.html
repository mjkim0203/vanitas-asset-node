<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VANITAS: ACCESS NODE</title>
    <style>
        /* --- [기본 스타일] --- */
        body { font-family: 'Courier New', monospace; margin: 0; padding: 0; background: #f4f4f4; color: #111; overflow-x: hidden; }
        
        /* --- [화면 1: 입장 페이지 (Login Screen)] --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: #f4f4f4;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100;
        }
        .login-box { text-align: center; width: 80%; max-width: 300px; }
        .logo-text { font-size: 2rem; font-weight: bold; margin-bottom: 40px; letter-spacing: -2px; }
        
        /* --- [화면 2: 경매 페이지 (Auction Screen)] --- */
        #auction-screen { display: none; padding: 20px; } /* 처음에는 숨김 처리 */
        
        .auction-box { background: white; padding: 20px; border: 1px solid black; max-width: 400px; margin: 0 auto; box-shadow: 5px 5px 0px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid black; padding-bottom: 10px; font-size: 1.2rem; }
        .price-display { font-size: 1.5rem; font-weight: bold; margin: 20px 0; text-align: center; }
        
        /* 공통 인풋 & 버튼 스타일 */
        input { width: 90%; padding: 15px; margin-bottom: 15px; border: 2px solid #000; background: transparent; font-family: inherit; font-size: 1rem; text-align: center; outline: none; }
        input:focus { background: #fff; }
        
        .btn { width: 100%; padding: 15px; background: black; color: white; font-size: 1rem; cursor: pointer; border: none; font-weight: bold; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        
        .rank-list { list-style: none; padding: 0; margin-top: 20px; border-top: 1px solid #ccc; }
        .rank-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #ddd; font-size: 0.9rem; }
        .rank-item.top { color: red; font-weight: bold; }
        
        /* 사용자 뱃지 */
        .user-badge { display: inline-block; background: #000; color: #fff; padding: 2px 5px; font-size: 0.8rem; margin-bottom: 10px; }

        .glitch { animation: glitch 0.1s linear; }
        @keyframes glitch { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(-2px, -2px); } 60% { transform: translate(2px, 2px); } 80% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <div class="logo-text">VANITAS<br>ASSET NODE</div>
            <p style="font-size: 0.8rem; margin-bottom: 20px;">ENTER YOUR ID TO ACCESS</p>
            <input type="text" id="login-input" placeholder="NICKNAME">
            <button class="btn" id="enter-btn">ENTER NODE</button>
        </div>
    </div>

    <div id="auction-screen">
        <div class="auction-box" id="auction-ui">
            <div class="user-badge" id="display-name">USER: ???</div>
            
            <h2>ITEM #404: Deleted_Love.txt</h2>
            
            <div class="price-display">
                CURRENT: <span id="current-price">0</span> DZC
            </div>
            
            <button class="btn" id="bid-btn">BID (+1,000 DZC)</button>

            <h3 style="font-size: 1rem; margin-top: 30px;">LIVE RANKING (Realtime)</h3>
            <ul class="rank-list" id="ranking-board">
                </ul>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, get, update } 
        from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // ★★★ 기존에 쓰시던 Firebase 설정값을 여기에 다시 넣어주세요! ★★★
        const firebaseConfig = {
            apiKey: "AIzaSyD...", 
            authDomain: "your-project.firebaseapp.com",
            databaseURL: "https://vanitas-auction-default-rtdb.firebaseio.com/",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "12345678",
            appId: "1:12345678:web:..."
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const ITEM_ID = "item_404"; 
        const itemRef = ref(db, 'auctions/' + ITEM_ID);

        // --- [전역 변수: 사용자 닉네임 저장용] ---
        let currentUser = "";

        // --- [1. 입장(Login) 로직] ---
        const loginScreen = document.getElementById("login-screen");
        const auctionScreen = document.getElementById("auction-screen");
        const loginInput = document.getElementById("login-input");
        const enterBtn = document.getElementById("enter-btn");

        // 엔터 버튼 클릭 시
        enterBtn.addEventListener("click", () => {
            const name = loginInput.value.trim();
            if (name) {
                currentUser = name; // 닉네임 변수에 저장
                document.getElementById("display-name").innerText = "USER: " + currentUser;
                
                // 화면 전환 (입장화면 숨김 -> 경매화면 표시)
                loginScreen.style.display = "none";
                auctionScreen.style.display = "block";
            } else {
                alert("닉네임을 입력해주세요.");
            }
        });

        // --- [2. 실시간 데이터 연동 (기존 로직 유지)] ---
        onValue(itemRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                updateUI(data);
            } else {
                set(itemRef, { price: 0, topBidder: "System", history: [] });
            }
        });

        function updateUI(data) {
            const priceEl = document.getElementById("current-price");
            const board = document.getElementById("ranking-board");
            const box = document.getElementById("auction-ui");

            priceEl.innerText = data.price.toLocaleString();

            box.classList.remove("glitch");
            void box.offsetWidth; 
            box.classList.add("glitch");

            board.innerHTML = "";
            const history = data.history ? Object.values(data.history) : [];
            const recentBids = history.slice(-5).reverse();

            recentBids.forEach((bid, index) => {
                const li = document.createElement("li");
                li.className = index === 0 ? "rank-item top" : "rank-item";
                li.innerHTML = `<span>${index + 1}. ${bid.name}</span><span>${bid.amount.toLocaleString()} DZC</span>`;
                board.appendChild(li);
            });
        }

        // --- [3. 입찰 로직 수정 (저장된 닉네임 사용)] ---
        const bidBtn = document.getElementById("bid-btn");
        
        bidBtn.addEventListener("click", () => {
            // 닉네임이 없으면(비정상 접근) 실행 안함
            if(!currentUser) return; 

            get(itemRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const currentData = snapshot.val();
                    const newPrice = currentData.price + 1000;
                    let currentHistory = currentData.history || [];
                    
                    const newBid = {
                        name: currentUser, // ★ 여기서 저장된 닉네임을 사용합니다
                        amount: newPrice,
                        time: Date.now()
                    };
                    
                    update(itemRef, {
                        price: newPrice,
                        topBidder: currentUser,
                        history: [...currentHistory, newBid]
                    });
                }
            });
        });

    </script>
</body>
</html>
